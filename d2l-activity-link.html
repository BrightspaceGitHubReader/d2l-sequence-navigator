<link rel="import" href="bower_components/polymer/polymer-element.html">
<link rel="import" href="bower_components/polymer-siren-mixins/siren-entity-mixin.html">

<dom-module id="d2l-activity-link">
	<template>
		<style>
			:host {
				display: block;
			}
			.current {
				color: red;
			}
		</style>
		<a id="activityLink" on-click="setCurrent">[[entity.properties.title]]</a>
		<template is="dom-if" if="[[showComplete]]">
			&#10004
		</template>

	</template>
	<script>
		/*
		@mixes SirenEntityMixin
		*/
		class D2LActivityLink extends D2L.Polymer.Mixins.SirenEntityMixin( Polymer.Element ) {
			static get is() {
				return 'd2l-activity-link';
			}
			static get properties() {
				return {
					currentActivity: {
						type: String,
						value: '',
						notify: true
					},
					showComplete: {
						type: Boolean,
						value: false,
						computed: 'isComplete(entity)'
					}
				};
			}
			static get observers() {
				return [
					'onCurrentActivityChanged(currentActivity, entity)'
				];
			}

			constructor() {
				super();
			}

			ready() {
				super.ready();
			}

			setCurrent() {
				this.currentActivity = this._getLinkByRel( this.entity, 'self').href;
			}

			isComplete(entity) {
				return entity
					.getSubEntityByRel('about')
					.getSubEntityByClass('completion')
					.hasClass('completed');
			}

			onCurrentActivityChanged( currentActivity, entity ) {
				if ( currentActivity && entity ) {
					var current = this._getLinkByRel( entity, 'self').href === currentActivity;
					if ( current ) {
						this.$.activityLink.classList.add('current');
					} else {
						this.$.activityLink.classList.remove('current');
					}
				}
			}
		}
		customElements.define(D2LActivityLink.is, D2LActivityLink);
	</script>
</dom-module>
