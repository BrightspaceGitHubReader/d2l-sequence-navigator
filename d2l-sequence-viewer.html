<link rel="import" href="bower_components/polymer/polymer-element.html">
<link rel="import" href="bower_components/d2l-fetch-siren-entity-behavior/d2l-fetch-siren-entity-behavior.html">
<link rel="import" href="d2l-module-link.html">
<!--
'd2l-sequence-viewer'


@demo demo/index.hmtl
-->

<dom-module id="d2l-sequence-viewer">
	<template>
		<style>
			:host {
				display: block;
			}
		</style>
		<slot></slot>
		<h2>[[sirenEntity.properties.title]]</h2>
		<d2l-module-link entity="{{sirenEntity}}"></d2l-module-link>
	</template>
	<script>
		class D2LSequenceViewer extends Polymer.mixinBehaviors([D2L.PolymerBehaviors.FetchSirenEntityBehavior], Polymer.Element) {
			static get is() {
				return 'd2l-sequence-viewer';
			}
			static get properties() {
				return {
					url: {
						type: String,
						value: ""
					},
					token: {
						type: String,
						value: ""
					},
					sirenEntity: {
						type: Object
					},
					currentLink: {
						type: String,
						value: ""
					}
				}
			}
			async _fetchEntity ( entityUrl ) {

				var currentSirenEntity = await this._fetchEntityWithToken(
					entityUrl,
					() => Promise.resolve(this.token)
				);

				var parentLink = currentSirenEntity.getLinkByRel('up');

				if ( parentLink && parentLink.rel.length === 1 ) {
					return this._fetchEntity(parentLink.href);
				}
				return currentSirenEntity;
			}

			async ready( ){
				super.ready();
				this.sirenEntity = await this._fetchEntity(this.url);

			}

			constructor() {
				super();
			}
		}
		customElements.define(D2LSequenceViewer.is, D2LSequenceViewer);
	</script>
</dom-module>
