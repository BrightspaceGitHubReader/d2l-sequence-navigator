<link rel="import" href="bower_components/polymer/polymer-element.html">
<link rel="import" href="bower_components/d2l-fetch-siren-entity-behavior/d2l-fetch-siren-entity-behavior.html">

<!--
'd2l-sequence-viewer'


@demo demo/index.hmtl
-->

<dom-module id="d2l-sequence-viewer">
	<template>
		<style>
			:host {
				display: block;
			}
		</style>
		<slot></slot>
		<h2>[[sirenEntity.class]]</h2>
	</template>
	<script>
		class D2LSequenceViewer extends Polymer.mixinBehaviors([D2L.PolymerBehaviors.FetchSirenEntityBehavior], Polymer.Element) {
			static get is() {
				return 'd2l-sequence-viewer';
			}
			static get properties() {
				return {
					url: {
						type: String,
						observer: '_getSirenEntity',
						value: ""
					},
					token: {
						type: String,
						value: ""
					},
					sirenEntity: {
						type: Object,
						observer: '_fetchTree'
					},
					currentLink: {
						type: String,
						value: ""
					}
				}
			}
			_getSirenEntity(){
				var fetchEntity = async() => {
					this.sirenEntity = await this._fetchEntityWithToken(
						this.url,
						() => Promise.resolve(this.token)
						);	
				}
				fetchEntity()
			}
			_fetchTree(){
				console.log(this.sirenEntity)
				var parentLink = this.sirenEntity.getLinkByRel('up')
				if( parentLink ) {
					// If we have parentLink, then call up.
					console.log("We need to go up!")
					console.log(parentLink)
					this.url = parentLink.href
				} else {
					console.log("We've found the root")
					console.log(this.sirenEntity)
				}
			}
			constructor() {
				super();
			}
		}
		customElements.define(D2LSequenceViewer.is, D2LSequenceViewer);
	</script>
</dom-module>
