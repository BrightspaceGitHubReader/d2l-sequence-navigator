<link rel="import" href="bower_components/polymer/polymer-element.html">
<link rel="import" href="bower_components/d2l-fetch-siren-entity-behavior/d2l-fetch-siren-entity-behavior.html">
<link rel="import" href="d2l-activity-link.html">

<dom-module id="d2l-module-link">
	<template>
		<style>
			:host {
				display: block;
			}
		</style>
		<slot></slot>
		<a>[[entity.properties.title]]</a>
		<ul>
		<template is="dom-repeat" items="[[entity.entities]]">

			<template is="dom-if" if="[[showChildModule(item)]]">
				<li>
					<d2l-module-link entity="[[item]]">
					</d2l-module-link>
				</li>
			</template>
			<template is="dom-if" if="[[showChildActivity(item)]]">
				<li>
					<d2l-activity-link entity="[[item]]">
					</d2l-activity-link>
				</li>
			</template>
		</li>
		</template>
		</ul>

	</template>
	<script>
		class D2LModuleLink extends Polymer.mixinBehaviors([D2L.PolymerBehaviors.FetchSirenEntityBehavior], Polymer.Element) {
			static get is() {
				return 'd2l-module-link';
			}
			static get properties() {
				return {
					entity: {
						type: Object
					}
				}
			}
			showChildModule(childEntity){
				return childEntity.class[1] === 'sequence-description';
			}
			showChildActivity(childEntity) {
				return childEntity.class[0] === 'sequenced-activity' && Object.keys(childEntity.properties).length > 0;
			}

			constructor() {
				super();
			}
			ready(){
				super.ready();
			}
		}
		customElements.define(D2LModuleLink.is, D2LModuleLink);
	</script>
</dom-module>
